<!DOCTYPE html>
<html lang="zh-cn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=0.9, user-scalable=no">
<meta name="keyword" content="">
<meta name="description" content="">
<meta name="author" content="lightuni.com">

<link rel="stylesheet" href="../../css/all.css">

<!-- <link rel="stylesheet" href="../../plugins/bootstrap/css/bootstrap.min.css"> -->
<link rel="stylesheet" href="../../plugins/adminLTE/css/AdminLTE.min.css">
<link rel="stylesheet" href="../../plugins/adminLTE/css/skins/_all-skins.min.css">
<link rel="stylesheet" href="../../plugins/Font-Awesome/css/font-awesome.min.css">
<link rel="stylesheet" href="../../plugins/cong/cong.css">


<script src="../../js/all.js"></script>

    <title>房态图</title>

<link rel="stylesheet" href="../../plugins/fancybox/fancybox.css">
<script src="../../plugins/fancybox/fancybox.js"></script>
<style>

.clearfix:after{ display:block; visibility:hidden; clear:both; height:0; content:"";}
.clearfix{zoom:1;}


/*左侧导航菜单    home*/
.sideMenu{ border:1px solid #ddd; }
.sideMenu h3{}
.sideMenu h3{
	margin:0;
	height:32px;
	line-height:32px;
	padding-left:10px;
	border-top:1px solid #e3e3e3;
	background:#f4f4f4;
	cursor:pointer;
	font-weight: bold;
	font-size: 14px;
	color: #333;
}
.sideMenu ul .nLi.on .sub{ display: block;}
.sideMenu ul .nLi .sub{ padding:8px 0; color:#999; display:none; }
.sideMenu ul {padding-left: 0;}
.sideMenu ul li{ list-style: none;}
/* .sideMenu ul .nLi .sub li{ height: 30px; line-height: 30px;} */
.sideMenu ul .nLi .sub li a{ display: block; width: 100%; height: 100%; font-family: 'Microsoft YaHei'; font-size: 14px; color: #333; text-decoration: none; padding:0 25px; box-sizing:border-box;}
.sideMenu ul .nLi .sub li a:hover{ background: #C4DDEC;}
/*左侧导航菜单    end*/
</style>

<style>
.datepicker{
  z-index: 9999;
}
</style>
</head>
<body class="hold-transition sidebar-mini skin-blue">

<div id="loading">
  <i class="fa fa-spinner fa-pulse fa-3x fa-fw"></i>
  <span class="sr-only">Loading...</span>
</div>

<div class="wrapper" id="app" style="display: none">

  <header class="main-header">
    <!-- Logo -->
    <a href="../index.html" class="logo">
      <!-- mini logo for sidebar mini 50x50 pixels -->
      <span class="logo-mini">商户后台</span>
      <!-- logo for regular state and mobile devices -->
      <span class="logo-lg">商户后台</span>
    </a>
    <!-- Header Navbar: style can be found in header.less -->
    <nav class="navbar navbar-static-top">
      <!-- Sidebar toggle button-->
      <a href="#" class="sidebar-toggle" data-toggle="push-menu" role="button">
        <span class="sr-only">Toggle navigation</span>
      </a>

      <div class="navbar-custom-menu">
        <ul class="nav navbar-nav">
          <li class="dropdown user user-menu">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
              <img src="../../plugins/adminLTE/img/user2-160x160.jpg" class="user-image" alt="User Image">
              <span class="hidden-xs">{{admin.user}}</span>
            </a>
            <ul class="dropdown-menu">
              <!-- User image -->
              <li class="user-header">
                <img src="../../plugins/adminLTE/img/user2-160x160.jpg" class="img-circle" alt="User Image">
                <p>
                  {{admin.user}}
                  <small>管理员</small>
                </p>
              </li>
              <!-- Menu Footer-->
              <li class="user-footer">
                <div class="pull-left">
                  <!-- <a href="#" class="btn btn-default btn-flat">设置</a> -->
                </div>
                <div class="pull-right">
                  <a class="btn btn-default btn-flat" href="javascript:;" @click="logout()">登出</a>
                </div>
              </li>
            </ul>
          </li>
          <!-- Control Sidebar Toggle Button -->
<!--           <li>
            <a href="#" data-toggle="control-sidebar"><i class="fa fa-gears"></i></a>
          </li> -->
        </ul>
      </div>
    </nav>
  </header>


  <aside class="main-sidebar">

    <section class="sidebar">

      <div class="user-panel">
        <div class="pull-left image">
          <img src="../../plugins/adminLTE/img/user2-160x160.jpg" class="img-circle" alt="User Image">
        </div>
        <div class="pull-left info">
          <p>{{admin.user}}</p>
          <i class="fa fa-circle text-success"></i> 在线
        </div>
      </div>


      <ul class="sidebar-menu" data-widget="tree">

        <li :class="{'treeview': v.children.length != 0, 'active': v.title_en == mca.c}" v-for="(v, i) in sidemenu">

          <a :href="`../${v.url == '#' ? v.url : v.url + '.html'}`">
            <i :class="`fa fa-${v.icon}`"></i> <span>{{v.title}}</span>
            <span class="pull-right-container" v-if="v.children.length != 0">
              <i class="fa fa-angle-left pull-right"></i>
            </span>
          </a>
          <ul class="treeview-menu" v-if="v.children.length != 0">

            <li :class="{'treeview': v2.children.length != 0, 'active': v2.title_en == mca.a}" v-for="(v2, i2) in v.children">

              <a :href="`../${v2.url == '#' ? v2.url : v2.url + '.html'}`"
              v-if="!(admin.isPrimaryAccount == 2 && v2.title == '员工账号')">
                <i :class="`fa fa-${v2.icon}`"></i> <span> {{v2.title}}</span>
                <span class="pull-right-container" v-if="v2.children.length != 0">
                  <i class="fa fa-angle-left pull-right"></i>
                </span>
              </a>
              <ul class="treeview-menu" v-if="v2.children.length != 0">

                <li v-for="(v3, i3) in v2.children">
                  <a :href="`../${v3.url == '#' ? v3.url : v3.url + '.html'}`">
                    <i :class="`fa fa-${v3.icon}`"></i> {{v3.title}}
                  </a>
                </li>

              </ul>
            </li>

          </ul>
        </li>

      </ul>
    </section>

  </aside>


  <div class="content-wrapper">

    <section class="content-header">
      <h1>
        房态图
      </h1>
      <ol class="breadcrumb">
        <li><i class="fa fa-home"></i> 首页</li>
        <li>旅客管理</li>
        <li class="active">房态图</li>
      </ol>
    </section>

    <section class="content">

<div class="box box-primary">
	<div class="box-header with-border">
		<h3 class="box-title">{{admin.primaryAccountName}}</h3>
	</div>
	<div class="box-body">

		<div class="clearfix">

		  <div style="display:flex;">

			<div class="cf" style="flex:3">

			  <div class="fl w120 mr15 mb15 yj5"
			  :style="`box-shadow: 0 0 7px #3C8DBC; border: 1px solid #3C8DBC;${v.guestNum != 0 ? ' background:#C4DDEC;':''}`"
			  v-for="(v, i) in list.data"
			  @click="get旅客访客(v.id, {buildingId:v.buildingId,floorId:v.floorId})">
				<div class="pr h60">
				  <div class="mt10 ml15 b">{{v.title.length > 5 ? v.title.substr(0,5) + '..':v.title}}</div>
				  <div class="pa left15 bottom10">
					入住 <span class="red">{{v.guestNum}}</span> | 
					访客 <span class="red">{{v.visitorNum}}</span>
				  </div>
				</div>
			  </div>

			</div>

			<div style="flex:1">

				<div class="input-group">
				  <input type="text" class="form-control" v-model="list.post.title" @change="list.post.floorId = 0;">
					<span class="input-group-btn">
					  <button class="btn btn-primary" @click="list.post.pageNum = 1; getList()">
						查找
						<i class="fa fa-spinner fa-spin" v-if="list.loading == 1"></i>
					  </button>
					</span>
				</div>

				<br>

				<div class="sideMenu">
					<ul>
						<li class="nLi">
							<h3 @click="list.post.title = ''; list.post.floorId = 0; getList();">全部</h3>
						</li>
						<li :class="`nLi${i == 0 ? ' on':''}`" v-for="(v,i) in 楼层树">
							<h3><div class="fl w30"><i class="fa fa-plus-square-o"></i></div>{{v.title}}</h3>
							<ul class="sub on">
								<li v-for="(v2,i2) in v.hsFloorInfoList" :style="`${list.post.floorId == v2.id ? 'background: #C4DDEC;':''}`">
									<a href="javascript:;" @click="
                  list.post.title = '';
                  list.post.floorId = v2.id;
                  getList();">
										<div class="fl w15">
											<i class="fa fa-caret-right" v-if="list.post.floorId == v2.id"></i>
											<span v-if="list.post.floorId != v2.id">&nbsp;</span>
										</div>
										{{v2.title}}
									</a>
								</li>
							</ul>
						</li>
					</ul>
				</div>

			</div>

		  </div>


              <div class="pull-left mt15">
                <label>
                  <select class="form-control input-sm" v-model="list.post.pageSize" @change="list.post.pageNum = 1; getList()">
                    <option value="2">每页 2 条</option>
                    <option value="10">每页 10 条</option>
                    <option value="25">每页 25 条</option>
                    <option value="50">每页 50 条</option>
                    <option value="100">每页 100 条</option>
                  </select>
                </label>

                &nbsp;&nbsp;共 {{list.info.total}} 条记录 {{list.info.text}}
              </div>

              <div class="pull-right" v-if="list.info.pages > 1">
                <ul class="pagination pagination-sm">

                  <li class="paginate_button"><a href="javascript:;" @click="getList('page','-1')">&lt;</a></li>

                  <li class="paginate_button" v-for="i in list.page.prev"><a href="javascript:;" @click="list.post.pageNum = i; getList()">{{i}}</a></li>

                  <li class="paginate_button active"><a href="#">{{list.post.pageNum}}</a></li>

                  <li class="paginate_button" v-for="i in list.page.next"><a href="javascript:;" @click="list.post.pageNum = i; getList()">{{i}}</a></li>

                  <li class="paginate_button"><a href="javascript:;" @click="getList('page','+1')">&gt;</a>
                  </li>

                </ul>
              </div>

		</div>

	</div>
</div>

    </section>


    <div class="modal fade" id="旅客访客">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">
              旅客访客
            </h4>
          </div>
          <div class="modal-body">
			  入住人员：{{旅客访客.guestList.length}}人　
        <a class="btn btn-sm btn-primary" @click="get办理入住()">办理入住</a>
        <a class="btn btn-sm btn-danger" @click="if(confirm('确认批量离店？'))批量离店('旅客')"
        v-if="旅客访客.guestList.length != 0">批量离店 <i class="fa fa-spinner fa-spin" v-if="旅客访客.guestList_菊花 == 1"></i></a>
			  <table class="table table-bordered">
				  <thead>
					  <tr>
              <th width="1%">
                <input type="checkbox"
                :checked="JSON.stringify(旅客访客.guestList_选中) === JSON.stringify(旅客访客.guestList_全选)"
                onclick="app.全选('旅客访客.guestList', this.checked)">
              </th>
						  <th width="60">头像</th>
						  <th>旅客识别号</th>
						  <th>旅客姓名</th>
						  <th>身份证号</th>
						  <th>性别</th>
						  <th>入住日期</th>
						  <th>离店日期</th>
						  <th width="1%" class="noenter">操作</th>
					  </tr>
				  </thead>
				  <tbody>
					  <tr v-for="v in 旅客访客.guestList">
              <td><input type="checkbox" :value="`${v.id}`" v-model="旅客访客.guestList_选中"
                @change="旅客访客.guestList_选中 = 旅客访客.guestList_选中.sort()"></td>
						  <td><a class="fancybox" :href="`http://image.zzb110.cn${v.headimgUrl}`"><img :src="`http://image.zzb110.cn${v.headimgUrl}`" width="100%"></a></td>
						  <td>{{v.visitorId}}</td>
						  <td>{{v.realName}}</td>
						  <td>{{v.identityCard}}</td>
						  <td>{{性别[v.sex]}}</td>
						  <td>{{v.checkinTime}}</td>
						  <td>{{v.leaveTime}}</td>
						  <td class="noenter">
							  <a class="btn btn-xs btn-primary mb5" href="javascript:;" @click="getView(v.id, 'Guest')">修改</a><br>
							  <a class="btn btn-xs btn-danger" href="javascript:;" @click="if(confirm('确认离店？'))离店(v.id, 'Guest')">离店</a>
						  </td>
					  </tr>
            <tr v-if="旅客访客.guestList.length == 0">
              <td colspan="9" class="tc" style="line-height: 100px;">没有记录</td>
            </tr>
				  </tbody>
			  </table>
			  
			  <br><br>

			  房间访客：{{旅客访客.visitorList.length}}人　
        <a class="btn btn-sm btn-primary" href="javascript:;" @click="get来访登记('')">来访登记</a>
        <a class="btn btn-sm btn-danger" href="javascript:;"
        v-if="旅客访客.visitorList.length != 0"
        @click="if(confirm('确认批量离店？'))批量离店('访客')">批量离店 <i class="fa fa-spinner fa-spin" v-if="旅客访客.visitorList_菊花 == 1"></i></a>
			  <table class="table table-bordered">
				  <thead>
					  <tr>
              <th width="1%">
                <input type="checkbox"
                :checked="JSON.stringify(旅客访客.visitorList_选中) === JSON.stringify(旅客访客.visitorList_全选)"
                onclick="app.全选('旅客访客.visitorList', this.checked)">
              </th>
						  <th width="60">头像</th>
						  <th>访客识别号</th>
						  <th>访客姓名</th>
						  <th>身份证号</th>
						  <th>性别</th>
						  <th>访问日期</th>
						  <th>离开日期</th>
						  <th width="1%" class="noenter">操作</th>
					  </tr>
				  </thead>
				  <tbody>
					  <tr v-for="v in 旅客访客.visitorList">
              <td><input type="checkbox" :value="`${v.id}`" v-model="旅客访客.visitorList_选中"
                @change="旅客访客.visitorList_选中 = 旅客访客.visitorList_选中.sort()"></td>
						  <td><a class="fancybox" :href="`http://image.zzb110.cn${v.headimgUrl}`"><img :src="`http://image.zzb110.cn${v.headimgUrl}`" width="100%"></a></td>
						  <td>{{v.visitorId}}</td>
						  <td>{{v.realName}}</td>
						  <td>{{v.identityCard}}</td>
						  <td>{{v.sex}}</td>
						  <td>{{v.visitTime}}</td>
						  <td>{{v.leaveTime}}</td>
						  <td class="noenter">
							  <a class="btn btn-xs btn-primary mb5" @click="getView(v.id, 'Visitor')">修改</a><br>
							  <a class="btn btn-xs btn-danger" @click="if(confirm('确认离店？'))离店(v.id, 'Visitor')">离店</a>
						  </td>
					  </tr>
            <tr v-if="旅客访客.visitorList.length == 0">
              <td colspan="9" class="tc" style="line-height: 100px;">没有记录</td>
            </tr>
				  </tbody>
			  </table>

		  </div>
		</div>
	  </div>
	</div>


    <div class="modal fade" id="办理入住">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">
              办理入住
            </h4>
          </div>
          <div class="modal-body">

        <table class="table table-bordered">
          <thead>
            <tr>
              <th width="60">头像</th>
              <th>旅客姓名</th>
              <th>手机号码</th>
              <th>身份证号</th>
              <th>性别</th>
              <th>通行设备</th>
              <th>楼栋</th>
              <th>楼层</th>
              <th>房间</th>
              <th>入住日期</th>
              <th>入住状态</th>
              <th width="1%" class="noenter">操作</th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="v in 办理入住">
              <td><a class="fancybox" :href="`http://image.zzb110.cn${v.headimgUrl}`"><img :src="`http://image.zzb110.cn${v.headimgUrl}`" height="60"></a></td>
              <td>{{v.realName}}</td>
              <td>{{v.mobile}}</td>
              <td>{{v.identityCard.substr(0,4)}}****{{v.identityCard.substr(-4)}}</td>
              <td>{{性别[v.sex]}}</td>
              <td>{{v.deviceTitle}}</td>
              <td>{{v.buildingName}}</td>
              <td>{{v.floorName}}</td>
              <td>{{v.roomName}}</td>
              <td>{{v.checkinTime}}</td>
              <td>{{入住状态[v.checkinStatus]}}</td>
              <td class="text-nowrap operation">
                <a class="btn btn-xs btn-primary" v-if="v.checkinStatus == 0" @click="get办理入住View(v.id)">办理入住</a><br>
              </td>
            </tr>
            <tr v-if="办理入住 == undefined">
              <td colspan="12" class="tc" style="line-height: 100px;">没有新旅客</td>
            </tr>
          </tbody>
        </table>

          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="办理入住view">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">
              办理入住
            </h4>
          </div>
          <div class="modal-body">

            <form class="form-horizontal">

              <div class="row">

                <div class="col-sm-6">

<div class="form-group">
  <label class="col-sm-5 control-label">访客姓名</label>
  <div class="col-sm-7">
    <input type="text" class="form-control input-sm" v-model="view.realName" disabled>
  </div>
</div>

<div class="form-group">
  <label class="col-sm-5 control-label">手机号码</label>
  <div class="col-sm-7">
    <input type="text" class="form-control input-sm" v-model="view.mobile" disabled>
  </div>
</div>

<div class="form-group">
  <label class="col-sm-5 control-label">身份证号</label>
  <div class="col-sm-7">
    <input type="text" class="form-control input-sm" v-model="view.identityCard" disabled>
  </div>
</div>

<div class="form-group">
  <label class="col-sm-5 control-label">性别</label>
  <div class="col-sm-7">
    <select class="form-control" v-model="view.sex" disabled>
      <option value="0">--请选择--</option>
      <option :value="`${i}`" v-for="(v, i) in 性别">{{v}}</option>
    </select>
  </div>
</div>

<hr>

<div class="form-group">
  <label class="col-sm-5 control-label">楼栋 <span class="text-danger">*</span></label>
  <div class="col-sm-7">
    <select class="form-control" v-model="view.buildingId" @change="get楼层(1)">
      <option value="">--请选择--</option>
      <option :value="`${i}`" v-for="(v,i) in 楼栋">{{v}}</option>
    </select>
  </div>
</div>

<div class="form-group">
  <label class="col-sm-5 control-label">楼层 <span class="text-danger">*</span></label>
  <div class="col-sm-7">
    <select class="form-control" v-model="view.floorId" @change="get房间(1)">
      <option value="">--请选择--</option>
      <option :value="`${i}`" v-for="(v,i) in 楼层">{{v}}</option>
    </select>
  </div>
</div>

<div class="form-group">
  <label class="col-sm-5 control-label">入住房间号 <span class="text-danger">*</span></label>
  <div class="col-sm-7">
    <select class="form-control" v-model="view.roomId">
      <option value="">--请选择--</option>
      <option :value="`${i}`" v-for="(v,i) in 房间">{{v}}</option>
    </select>
  </div>
</div>

<div class="form-group">
  <label class="col-sm-5 control-label">入住日期 <span class="text-danger">*</span></label>
  <div class="col-sm-7">
    <input type="text" class="form-control input-sm datepicker" autocomplete="off" id="入住日期">
  </div>
</div>

<div class="form-group">
  <label class="col-sm-5 control-label">离店日期 <span class="text-danger">*</span></label>
  <div class="col-sm-7">
    <input type="text" class="form-control input-sm datepicker" autocomplete="off" id="离店日期">
  </div>
</div>

                </div>
                <div class="col-sm-6 tc">

                  <img :src="`http://image.zzb110.cn${view.headimgUrl}`" id="预览图片" width="80%"><br>

                  照片

                </div>

              </div>

              <hr>

<!-- <div class="form-group">
  <label class="col-sm-3 control-label mt6">每日通行时间</label>
  <div class="col-sm-9">
    <table class="table table-bordered">
      <tr v-for="(v, i) in view.validCycle">
        <td width="25%"><input class="form-control input-sm datepicker" type="text" v-model="v.start_time"></td>
        <td class="tc"><div class="mt6">至</div></td>
        <td width="25%"><input class="form-control input-sm datepicker" type="text" v-model="v.end_time"></td>
        <td>
          <div class="mt3">
            <a class="btn btn-xs btn-default" @click="order_rules(i, '-')"><i class="fa fa-arrow-up"></i></a>
            <a class="btn btn-xs btn-default" @click="order_rules(i, '+')"><i class="fa fa-arrow-down"></i></a>
            <a class="btn btn-xs btn-danger" @click="del_rules(i)"><i class="fa fa-remove"></i></a>
          </div>
        </td>
      </tr>
    </table>
    <div class="mt10">
      <a class="btn btn-sm btn-primary" href="javascript:;" @click="add_rules()">增加一条</a>
    </div>
  </div>
</div> -->

<div class="form-group">
  <label class="col-sm-3 control-label">通行设备 <span class="text-danger">*</span></label>
  <div class="col-sm-9">
    <div class="checkbox">
      <label>
        <input type="checkbox" :checked="JSON.stringify(view.deviceSn) === JSON.stringify(通行设备全选时)"
        onclick="app.通行设备全选(this.checked)"> 全选
      </label>
    </div>
    <div class="checkbox fl w150" v-for="v in 通行设备">
      <label>
        <input type="checkbox" :value="`${v.sn}`" v-model="view.deviceSn" @change="通行设备排序()"> {{v.title}}
      </label>
    </div>
  </div>
</div>

            </form>

          </div>
          <div class="modal-footer">
            <a class="btn btn-primary" @click="save办理入住View()">提交</a>
          </div>
        </div>
      </div>
    </div>


    <div class="modal fade" id="来访登记">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">
              来访登记
            </h4>
          </div>
          <div class="modal-body">

        <table class="table table-bordered">
          <thead>
            <tr>
              <th width="60">头像</th>
              <th>访客姓名</th>
              <th>手机号码</th>
              <th>身份证号</th>
              <th>性别</th>
              <th>通行设备</th>
              <th>拜访人员</th>
              <th>访问时间</th>
              <th width="1%" class="noenter">操作</th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="v in 来访登记">
              <td><a class="fancybox" :href="`http://image.zzb110.cn${v.headimgUrl}`"><img :src="`http://image.zzb110.cn${v.headimgUrl}`" height="60"></a></td>
              <td>{{v.realName}}</td>
              <td>{{v.mobile}}</td>
              <td>{{v.identityCard.substr(0,4)}}****{{v.identityCard.substr(-4)}}</td>
              <td>{{性别[v.sex]}}</td>
              <td>{{v.deviceTitle}}</td>
              <td>{{v.beVisited}}</td>
              <td>{{v.visitTime}}</td>
              <td class="text-nowrap operation">
                <a class="btn btn-xs btn-primary" @click="get来访登记View(v.id)">来访登记</a><br>
              </td>
            </tr>
            <tr v-if="来访登记 == undefined">
              <td colspan="12" class="tc" style="line-height: 100px;">没有新访客</td>
            </tr>
          </tbody>
        </table>

          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="来访登记view">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">
              来访登记
            </h4>
          </div>
          <div class="modal-body">

            <form class="form-horizontal">

              <div class="row">

                <div class="col-sm-6">

<div class="form-group">
  <label class="col-sm-5 control-label">访客姓名</label>
  <div class="col-sm-7">
    <input type="text" class="form-control input-sm" v-model="view.realName" disabled>
  </div>
</div>

<div class="form-group">
  <label class="col-sm-5 control-label">手机号码</label>
  <div class="col-sm-7">
    <input type="text" class="form-control input-sm" v-model="view.mobile" disabled>
  </div>
</div>

<div class="form-group">
  <label class="col-sm-5 control-label">身份证号</label>
  <div class="col-sm-7">
    <input type="text" class="form-control input-sm" v-model="view.identityCard" disabled>
  </div>
</div>

<div class="form-group">
  <label class="col-sm-5 control-label">性别</label>
  <div class="col-sm-7">
    <select class="form-control" v-model="view.sex" disabled>
      <option value="0">--请选择--</option>
      <option :value="`${i}`" v-for="(v, i) in 性别">{{v}}</option>
    </select>
  </div>
</div>

<hr>

<div class="form-group">
  <label class="col-sm-5 control-label">被访房间</label>
  <div class="col-sm-7">
    <input type="text" class="form-control input-sm" v-model="view.roomName" disabled>
  </div>
</div>

<div class="form-group">
  <label class="col-sm-5 control-label">楼栋 <span class="text-danger">*</span></label>
  <div class="col-sm-7">
    <select class="form-control" v-model="view.buildingId" @change="get楼层(1)">
      <option value="">--请选择--</option>
      <option :value="`${i}`" v-for="(v,i) in 楼栋">{{v}}</option>
    </select>
  </div>
</div>

<div class="form-group">
  <label class="col-sm-5 control-label">楼层 <span class="text-danger">*</span></label>
  <div class="col-sm-7">
    <select class="form-control" v-model="view.floorId" @change="get房间(1)">
      <option value="">--请选择--</option>
      <option :value="`${i}`" v-for="(v,i) in 楼层">{{v}}</option>
    </select>
  </div>
</div>

<div class="form-group">
  <label class="col-sm-5 control-label">房间号 <span class="text-danger">*</span></label>
  <div class="col-sm-7">
    <select class="form-control" v-model="view.roomId">
      <option value="">--请选择--</option>
      <option :value="`${i}`" v-for="(v,i) in 房间">{{v}}</option>
    </select>
  </div>
</div>

<div class="form-group">
  <label class="col-sm-5 control-label">拜访人员</label>
  <div class="col-sm-7">
    <input type="text" class="form-control input-sm" v-model="view.beVisited">
  </div>
</div>

<div class="form-group">
  <label class="col-sm-5 control-label">携带物品</label>
  <div class="col-sm-7">
    <input type="text" class="form-control input-sm" v-model="view.tote">
  </div>
</div>

<div class="form-group">
  <label class="col-sm-5 control-label">访问时间 <span class="text-danger">*</span></label>
  <div class="col-sm-7">
    <input type="text" class="form-control input-sm datepicker" autocomplete="off" id="访问时间">
  </div>
</div>

<div class="form-group">
  <label class="col-sm-5 control-label">离开时间 <span class="text-danger">*</span></label>
  <div class="col-sm-7">
    <input type="text" class="form-control input-sm datepicker" autocomplete="off" id="离开时间">
  </div>
</div>

                </div>
                <div class="col-sm-6 tc">

                  <img :src="`http://image.zzb110.cn${view.headimgUrl}`" id="预览图片" width="80%"><br>

                  照片

                </div>

              </div>

              <hr>

<!-- <div class="form-group">
  <label class="col-sm-3 control-label mt6">每日通行时间</label>
  <div class="col-sm-9">
    <table class="table table-bordered">
      <tr v-for="(v, i) in view.validCycle">
        <td width="25%"><input class="form-control input-sm datepicker" type="text" v-model="v.start_time"></td>
        <td class="tc"><div class="mt6">至</div></td>
        <td width="25%"><input class="form-control input-sm datepicker" type="text" v-model="v.end_time"></td>
        <td>
          <div class="mt3">
            <a class="btn btn-xs btn-default" @click="order_rules(i, '-')"><i class="fa fa-arrow-up"></i></a>
            <a class="btn btn-xs btn-default" @click="order_rules(i, '+')"><i class="fa fa-arrow-down"></i></a>
            <a class="btn btn-xs btn-danger" @click="del_rules(i)"><i class="fa fa-remove"></i></a>
          </div>
        </td>
      </tr>
    </table>
    <div class="mt10">
      <a class="btn btn-sm btn-primary" href="javascript:;" @click="add_rules()">增加一条</a>
    </div>
  </div>
</div> -->

<div class="form-group">
  <label class="col-sm-3 control-label">通行设备 <span class="text-danger">*</span></label>
  <div class="col-sm-9">
    <div class="checkbox">
      <label>
        <input type="checkbox" :checked="JSON.stringify(view.deviceSn) === JSON.stringify(通行设备全选时)"
        onclick="app.通行设备全选(this.checked)"> 全选
      </label>
    </div>
    <div class="checkbox fl w150" v-for="v in 通行设备">
      <label>
        <input type="checkbox" :value="`${v.sn}`" v-model="view.deviceSn" @change="通行设备排序()"> {{v.title}}
      </label>
    </div>
  </div>
</div>

            </form>

          </div>
          <div class="modal-footer">
            <a class="btn btn-primary" @click="save来访登记View()">提交</a>
          </div>
        </div>
      </div>
    </div>


    <div class="modal fade" id="view">
      <div class="modal-dialog">
        <div class="modal-content">

          <div class="modal-body">

            <form class="form-horizontal pr">


<div class="pa right0 w130 tc">

  <img :src="`http://image.zzb110.cn${view.headimgUrl}`" id="预览图片" width="100%"><br>

  照片

</div>

<div class="form-group">
  <label class="col-sm-3 control-label">访客姓名</label>
  <div class="col-sm-5">
    <input type="text" class="form-control input-sm" v-model="view.realName" disabled>
  </div>
</div>

<div class="form-group">
  <label class="col-sm-3 control-label">手机号码</label>
  <div class="col-sm-5">
    <input type="text" class="form-control input-sm" v-model="view.mobile" disabled>
  </div>
</div>

<div class="form-group">
  <label class="col-sm-3 control-label">身份证号</label>
  <div class="col-sm-5">
    <input type="text" class="form-control input-sm" v-model="view.identityCard" disabled>
  </div>
</div>

<div class="form-group">
  <label class="col-sm-3 control-label">性别</label>
  <div class="col-sm-5">
    <select class="form-control" v-model="view.sex" disabled>
      <option value="0">--请选择--</option>
      <option :value="`${i}`" v-for="(v, i) in 性别">{{v}}</option>
    </select>
  </div>
</div>

<template v-if="view.visitorType == 3">
<div class="form-group">
  <label class="col-sm-3 control-label">入住日期 <span class="text-danger">*</span></label>
  <div class="col-sm-5">
    <input type="text" class="form-control input-sm datepicker" autocomplete="off" id="checkinTime">
  </div>
</div>
</template>

<template v-if="view.visitorType == 1">
<div class="form-group">
  <label class="col-sm-3 control-label">访问日期 <span class="text-danger">*</span></label>
  <div class="col-sm-5">
    <input type="text" class="form-control input-sm datepicker" autocomplete="off" id="visitTime">
  </div>
</div>
</template>

<div class="form-group">
  <label class="col-sm-3 control-label">离店日期 <span class="text-danger">*</span></label>
  <div class="col-sm-5">
    <input type="text" class="form-control input-sm datepicker" autocomplete="off" id="leaveTime">
  </div>
</div>

<div class="form-group">
  <label class="col-sm-3 control-label">房间号 <span class="text-danger">*</span></label>
  <div class="col-sm-3">
    <select class="form-control" v-model="view.buildingId" @change="get楼层(1)">
      <option value="">--请选择--</option>
      <option :value="`${i}`" v-for="(v,i) in 楼栋">{{v}}</option>
    </select>
  </div>
  <div class="col-sm-3">
    <select class="form-control" v-model="view.floorId" @change="get房间(1)">
      <option value="">--请选择--</option>
      <option :value="`${i}`" v-for="(v,i) in 楼层">{{v}}</option>
    </select>
  </div>
  <div class="col-sm-3">
    <select class="form-control" v-model="view.roomId">
      <option value="">--请选择--</option>
      <option :value="`${i}`" v-for="(v,i) in 房间">{{v}}</option>
    </select>
  </div>
</div>

              <hr>

<!-- <div class="form-group">
  <label class="col-sm-3 control-label mt6">每日通行时间</label>
  <div class="col-sm-9">
    <table class="table table-bordered">
      <tr v-for="(v, i) in view.validCycle">
        <td width="25%"><input class="form-control input-sm datepicker" type="text" v-model="v.start_time"></td>
        <td class="tc"><div class="mt6">至</div></td>
        <td width="25%"><input class="form-control input-sm datepicker" type="text" v-model="v.end_time"></td>
        <td>
          <div class="mt3">
            <a class="btn btn-xs btn-default" @click="order_rules(i, '-')"><i class="fa fa-arrow-up"></i></a>
            <a class="btn btn-xs btn-default" @click="order_rules(i, '+')"><i class="fa fa-arrow-down"></i></a>
            <a class="btn btn-xs btn-danger" @click="del_rules(i)"><i class="fa fa-remove"></i></a>
          </div>
        </td>
      </tr>
    </table>
    <div class="mt10">
      <a class="btn btn-sm btn-primary" href="javascript:;" @click="add_rules()">增加一条</a>
    </div>
  </div>
</div> -->

<div class="form-group">
  <label class="col-sm-3 control-label">通行设备 <span class="text-danger">*</span></label>
  <div class="col-sm-9">
    <div class="checkbox">
      <label>
        <input type="checkbox" :checked="JSON.stringify(view.deviceSn) === JSON.stringify(通行设备全选时)"
        onclick="app.通行设备全选(this.checked)"> 全选
      </label>
    </div>

    <div class="checkbox fl w150" v-for="v in 通行设备">
      <label>
        <input type="checkbox" :value="`${v.sn}`" v-model="view.deviceSn" @change="通行设备排序()"> {{v.title}}
      </label>
    </div>

  </div>
</div>

            </form>

          </div>
          <div class="modal-footer">
            <a class="btn btn-primary" @click="saveView()">提交</a>
          </div>
        </div>
      </div>
    </div>


  </div>

  <footer class="main-footer">
    <div class="pull-right hidden-xs">
      <b>Version</b> 2.4.0
    </div>
    商户后台
  </footer>

  <!-- Control Sidebar -->
  <aside class="control-sidebar control-sidebar-dark">
    <!-- Create the tabs -->
    <ul class="nav nav-tabs nav-justified control-sidebar-tabs">
      <li><a href="#control-sidebar-home-tab" data-toggle="tab"><i class="fa fa-home"></i></a></li>
      <li><a href="#control-sidebar-settings-tab" data-toggle="tab"><i class="fa fa-gears"></i></a></li>
    </ul>
    <!-- Tab panes -->
    <div class="tab-content">
      <!-- Home tab content -->
      <div class="tab-pane" id="control-sidebar-home-tab">
        <h3 class="control-sidebar-heading">维护团队</h3>
        <ul class="control-sidebar-menu">
          <li>
            <a href="javascript:void(0)">
              <i class="menu-icon fa fa-user bg-red"></i>

              <div class="menu-info">
                <h4 class="control-sidebar-subheading">韦聪</h4>

                <p>产品设计师</p>
              </div>
            </a>
          </li>
          <li>
            <a href="javascript:void(0)">
              <i class="menu-icon fa fa-phone bg-green"></i>

              <div class="menu-info">
                <h4 class="control-sidebar-subheading">电话</h4>

                <p>18902300094</p>
              </div>
            </a>
          </li>
          <li>
            <a href="javascript:void(0)">
              <i class="menu-icon fa fa-envelope-o bg-light-blue"></i>

              <div class="menu-info">
                <h4 class="control-sidebar-subheading">邮件</h4>

                <p>57425133@qq.com</p>
              </div>
            </a>
          </li>
        </ul>
        <!-- /.control-sidebar-menu -->

      </div>
      <!-- /.tab-pane -->
      <!-- Stats tab content -->
      <div class="tab-pane" id="control-sidebar-stats-tab">Stats Tab Content</div>
      <!-- /.tab-pane -->
      <!-- Settings tab content -->
      <div class="tab-pane" id="control-sidebar-settings-tab">
        <form method="post">
          <h3 class="control-sidebar-heading">General Settings</h3>

          <div class="form-group">
            <label class="control-sidebar-subheading">
              Report panel usage
              <input type="checkbox" class="pull-right" checked>
            </label>

            <p>
              Some information about this general settings option
            </p>
          </div>
          <!-- /.form-group -->

          <div class="form-group">
            <label class="control-sidebar-subheading">
              Allow mail redirect
              <input type="checkbox" class="pull-right" checked>
            </label>

            <p>
              Other sets of options are available
            </p>
          </div>
          <!-- /.form-group -->

          <div class="form-group">
            <label class="control-sidebar-subheading">
              Expose author name in posts
              <input type="checkbox" class="pull-right" checked>
            </label>

            <p>
              Allow the user to show his name in blog posts
            </p>
          </div>
          <!-- /.form-group -->

          <h3 class="control-sidebar-heading">Chat Settings</h3>

          <div class="form-group">
            <label class="control-sidebar-subheading">
              Show me as online
              <input type="checkbox" class="pull-right" checked>
            </label>
          </div>
          <!-- /.form-group -->

          <div class="form-group">
            <label class="control-sidebar-subheading">
              Turn off notifications
              <input type="checkbox" class="pull-right">
            </label>
          </div>
          <!-- /.form-group -->

          <div class="form-group">
            <label class="control-sidebar-subheading">
              Delete chat history
              <a href="javascript:void(0)" class="text-red pull-right"><i class="fa fa-trash-o"></i></a>
            </label>
          </div>
          <!-- /.form-group -->
        </form>
      </div>
      <!-- /.tab-pane -->
    </div>
  </aside>
  <!-- /.control-sidebar -->
  <!-- Add the sidebar's background. This div must be placed
       immediately after the control sidebar -->
  <div class="control-sidebar-bg"></div>
</div>
<!-- ./wrapper -->

<!-- <script src="../plugins/jquery/jquery.min.js"></script> -->
<!-- <script src="../plugins/bootstrap/js/bootstrap.min.js"></script> -->
<script src="../../plugins/adminLTE/js/adminlte.min.js"></script>
<script src="../../plugins/adminLTE/js/demo.js"></script>
<script src="../../plugins/cong/cong.js"></script>

<link rel="stylesheet" href="../../plugins/datepicker/datepicker.css">
<script src="../../plugins/datepicker/datepicker.js"></script>

<script src="../../js/exif.min.js"></script>
<script>
var app = new Vue({
  el: '#app',
  data: {
	mca: {},
		admin: {},
		sidemenu: {},

	list: {},
	// page: {},
	ids: [],
	ids_all: [],

	view: {},

	性别:{
		1:'男',
		2:'女',
	},

	软件版本:{
		1:'佳星',
		2:'万象',
		3:'湖南万象(斯雨)',
		4:'云辰',
		5:'龙管家'
	},

	接口类型: {
		1:'公安部',
		2:'海鑫',
		3:'国政通',
		4:'上海爱金'
	},

	接口版本: {
		1:'标准版',
		2:'简化版'
	},

	行业:{
		1:'旅馆',
		2:'网吧',
		3:'汽车站',
		4:'机场',
		5:'旅行社',
		6:'访客',
		7:'充电',
		8:'出租屋',
		9:'足浴'
	},

	行业软件: {
		0:'无软件',
		1:'佳星',
		2:'万象',
		3:'湖南万象(斯雨)',
		4:'云辰',
		5:'龙管家',
		6:'恒邦',
		7:'鼎泰云计费',
		10000:'中证宝酒店',
		10001:'中冠PMS',
		10002:'千里马酒店',
		10003:'锦江酒店',
		10004:'广电运通',
		10005:'金禧租赁',
		10006:'Xhotel',
		20000:'佛山曇京',
		60001:'华舜'
	},

	旅馆行业: {
		0:'无软件',
		10000:'中证宝酒店',
		10001:'中冠PMS',
		10002:'千里马酒店',
		10003:'锦江酒店',
		10004:'广电运通',
		10005:'金禧租赁',
		10006:'Xhotel',
		20000:'佛山曇京'
	},

	网吧行业: {
		0:'无软件',
		1:'佳星',
		2:'万象',
		3:'湖南万象(斯雨)',
		4:'云辰',
		5:'龙管家',
		6:'恒邦',
		7:'鼎泰云计费',
	},

	汽车站行业:{
		0:'无软件'
	},

	机场行业:{
		0:'无软件'
	},

	旅行社行业:{
		0:'无软件'
	},

	访客行业:{
		0:'无软件',
		20000:'佛山曇京',
		60001:'园区访客',
		60002:'酒店访客'
	},

	充电行业:{
		0:'无软件'
	},

	出租屋行业: {
		0:'无软件',
		10000:'中证宝酒店',
		10005:'金禧租赁',
	},

	足浴行业: {
		0:'无软件',
		10000:'中证宝酒店',
		10005:'金禧租赁',
	},

	状态: {
		1:'可用',
		2:'不可用'
	},

	是否加密: {
		0:'否',
		1:'是'
	},

	同步模式: {
		1:'在线（云服务器）',
		2:'xml文件（铃铛）',
		3:'本地数据库（LockSend）',
		4:'上海旅业',
		5:'湖南旅业',
		6:'身份证硬件',
		7:'金禧公寓',
	},

	分成基数: {
		1: '月消费总积分（对冲退款）',
		// 2: '日均消费总积分（对冲退款）'
	},

	分成模式: {
		1: '阶梯式累计分成'
	},

	支付方式: {
		0:'全部',
		1:'电子现金',
		2:'声波',
		3:'NFC',
		4:'扫码',
		5:'手输',
	},

	交易模式: {
		// 0:		'全部',
		10001:	'担保',
		10002:	'消费',
	},

	支付状态: {
		0:'未生成',
		1:'已提交担保',
		2:'担保完成',
		3:'担保撤销',
		4:'担保冲正',
		101:'支付',
		102:'支付冲正',
		103:'支付撤销',
		104:'支付退款'
	},

	证件类型: {
		1: '中证宝',
		2: '二代证',
	},

	入住状态:[
		'已预约',
		'已入住',
		'已离店'
	],

    a: {},

    list: {
      data: [],
      post: {
        pageNum: 1,
        pageSize: 100,
		    floorId: 0,
      },
      info: {},
      page: {},
      loading: 0,
      checkbox: {
        all: [],
        checked: [],
      },
    },

    楼层树: {},

    旅客访客:{
  	  guestList: [],
  	  visitorList: [],

      guestList_选中: [],
      visitorList_选中: [],

      guestList_菊花: 0,
      visitorList_菊花: 0,
    },

    办理入住: [],
    来访登记: [],

    msg: '',

  	组织架构: [],

  	楼栋: {},
  	楼层: {},
  	房间: {},

    通行设备: [],
    通行设备全选时: [],

  },
  methods: {
    checkAll: function(){

      if( $('#checkAll').prop('checked') ){
        this.list.checkbox.checked = this.list.checkbox.all
      }else{
        this.list.checkbox.checked = []
      }

    },

    logout: function(){

      //登出
      LS.removeItem('admin')
      location.reload()

    },

    getList: function(key, val){

      this.list.loading = 1

      if(key == 'page'){

        if(val == '+1'){
          if( this.list.post.pageNum < this.list.info.pages ){
            this.list.post.pageNum++
          }else{
            return
          }
        }

        if(val == '-1'){
          if( this.list.post.pageNum > 1 ){
            this.list.post.pageNum--
          }else{
            return
          }
        }

      }

      var data = {
        "reqHead":
        {
          clientType: 1,
          format: "json",
          version: "1.0",
          sign: "2A71F91102AE746493B3CDF67FCCDCF3"
        },
        reqBody: this.list.post
      }

      $.ajax({
        type: 'POST',
        url: mp_api + 'mp/getHsRoomListByFloorId/interface',
        data: JSON.stringify(data),
        dataType: 'json',
        beforeSend: function(request){
          request.setRequestHeader('Authorization', 'Bearer ' + _this.admin.token )
        },
        complete: function(){
          _this.list.loading = 0
        },
        success: function(re){

          _this.list.data = re.rspBody.hsRoomInfoList
          delete re.rspBody.hsRoomInfoList

          _this.list.info = re.rspBody

          //id
          for( var i in _this.list.data ){
            var v = _this.list.data[i]

            _this.list.checkbox.all.push(v.id)
          }

          //分页
          _this.list.page.prev = []
          for(var i = _this.list.info.pageNum - 4; i < _this.list.info.pageNum; i++){
            if(i <= 0)continue;
            _this.list.page.prev.push(i)
          }

          _this.list.page.next = []
          for(var i = _this.list.info.pageNum + 1; i < _this.list.info.pageNum + 5; i++){
            if(i > _this.list.info.pages)break;
            _this.list.page.next.push(i)
          }

        }
      })

    },
	
	  get旅客访客: function(id, json){

      if(json != undefined){
        this.a.buildingId = json.buildingId
        this.a.floorId = json.floorId
      }
      this.a.roomId = id

      var data = {
        "reqHead":
        {
          clientType: 1,
          format: "json",
          version: "1.0",
          sign: "UCR1fIQ9lyUCR1fIQ9lyUCR1fIQ9lyUCR1y"
        },
        reqBody: {
          roomId: id
        }
      }

      $.ajax({
        type: 'POST',
        url: mp_api + 'mp/getHsRoomUser/interface',
        data: JSON.stringify(data),
        dataType: 'json',
        beforeSend: function(request){
          request.setRequestHeader('Authorization', 'Bearer ' + _this.admin.token )
        },
        success: function(re){

          _this.旅客访客.roomId = re.rspBody.roomId
			    _this.旅客访客.guestList = re.rspBody.guestList
          _this.旅客访客.visitorList = re.rspBody.visitorList

          // 全选数组
          _this.旅客访客.guestList_全选 = []
          for(let i in _this.旅客访客.guestList){
            let v = _this.旅客访客.guestList[i]
            _this.旅客访客.guestList_全选.push(String(v.id))
          }
          _this.旅客访客.guestList_全选 = _this.旅客访客.guestList_全选.sort()
          // console.log('guestList_全选', _this.旅客访客.guestList_全选)


          _this.旅客访客.visitorList_全选 = []
          for(let i in _this.旅客访客.visitorList){
            let v = _this.旅客访客.visitorList[i]
            _this.旅客访客.visitorList_全选.push(String(v.id))
          }
          _this.旅客访客.visitorList_全选 = _this.旅客访客.visitorList_全选.sort()
          // console.log('visitorList_全选', _this.旅客访客.visitorList_全选)


          $('#旅客访客').modal('show')

          setTimeout(function(){
            $('.fancybox').fancybox()
          }, 100)

    		},
	    })

	  },

    get办理入住: function(){

      var data = {
        "reqHead":
        {
          clientType: 1,
          format: "json",
          version: "1.0",
          sign: "UCR1fIQ9lyUCR1fIQ9lyUCR1fIQ9lyUCR1y"
        },
        reqBody: {
          checkinStatus: 0
        }
      }

      $.ajax({
        type: 'POST',
        url: mp_api + 'mp/getHsGuestManageList/interface',
        data: JSON.stringify(data),
        dataType: 'json',
        beforeSend: function(request){
          request.setRequestHeader('Authorization', 'Bearer ' + _this.admin.token )
        },
        success: function(re){

          if(re.rspHead.retCode != '1'){
            alert(re.rspHead.retMsg)
          }

          _this.办理入住 = re.rspBody.hsGuestManageInfoList

          $('#办理入住').modal('show')

          setTimeout(function(){
            $('.fancybox').fancybox()
          })

        }
      })
    },

    get办理入住View: function(id){

      this.view = {
        deviceSn: []
      }

      var data = {
        "reqHead":
        {
          clientType: 1,
          format: "json",
          version: "1.0",
          sign: "UCR1fIQ9lyUCR1fIQ9lyUCR1fIQ9lyUCR1y"
        },
        reqBody: {
          id: id
        }
      }

      $.ajax({
        type: 'POST',
        url: mp_api + 'mp/getHsGuestManageInfo/interface',
        data: JSON.stringify(data),
        dataType: 'json',
        beforeSend: function(request){
          request.setRequestHeader('Authorization', 'Bearer ' + _this.admin.token )
        },
        success: function(re){

          if(re.rspHead.retCode == '1'){

            try{
              re.rspBody.deviceSn = JSON.parse(re.rspBody.deviceSn)
            }catch(e){
              re.rspBody.deviceSn = []
            }

/*            try{
              re.rspBody.validCycle = JSON.parse(re.rspBody.validCycle)
            }catch(e){
              re.rspBody.validCycle = [{start_time:'00:00',end_time:'23:59'}]
            }*/

            _this.view = re.rspBody

            _this.view.buildingId = _this.a.buildingId
            _this.view.floorId = _this.a.floorId
            _this.view.roomId = _this.a.roomId

            $('#办理入住view').modal('show')

            setTimeout(function(){
              _this.get楼层()
              _this.get房间()
              }, 100
            )

            //插件的值
            $('#入住日期').val(_this.view.checkinTime)
            $('#离店日期').val(_this.view.leaveTime)

            $('.datepicker').datepicker({
              format: 'yyyy-mm-dd'
            })

          }
          else{
            alert(re.rspBody.retMsg)
          }

        }
      })

    },

    save办理入住View: function(){

      var body2 = JSON.parse(JSON.stringify(this.view))

      body2.checkinTime = $('#入住日期').val()
      body2.leaveTime = $('#离店日期').val()

      // 合翻埋设备id
      body2.deviceSn = JSON.stringify(body2.deviceSn)

      body2.checkinStatus = 1

      // 头像
      delete body2.headimgUrl


      var data = {
        "reqHead":
        {
          clientType: 1,
          format: "json",
          version: "1.0",
          sign: "UCR1fIQ9lyUCR1fIQ9lyUCR1fIQ9lyUCR1y"
        },
        reqBody: body2
      }

      $.ajax({
        type: 'POST',
        url: mp_api + 'mp/editHsGuestManage/interface',
        data: JSON.stringify(data),
        dataType: 'json',
        beforeSend: function(request){
          request.setRequestHeader('Authorization', 'Bearer ' + _this.admin.token )
        },
        success: function(re){

          if(re.rspHead.retCode != '1'){
            alert(re.rspHead.retMsg)
          }

          _this.getList()
          _this.get旅客访客(_this.a.roomId)
          _this.get办理入住()
          alert('办理入住成功')
          $('#办理入住view').modal('hide')

        },
      })

    },

    get来访登记: function(){

      var data = {
        "reqHead":
        {
          clientType: 1,
          format: "json",
          version: "1.0",
          sign: "UCR1fIQ9lyUCR1fIQ9lyUCR1fIQ9lyUCR1y"
        },
        reqBody: {
          auditStatus: 0
        }
      }

      $.ajax({
        type: 'POST',
        url: mp_api + 'mp/getHsVisitorManageList/interface',
        data: JSON.stringify(data),
        dataType: 'json',
        beforeSend: function(request){
          request.setRequestHeader('Authorization', 'Bearer ' + _this.admin.token )
        },
        success: function(re){

          if(re.rspHead.retCode != '1'){
            alert(re.rspHead.retMsg)
          }

          _this.来访登记 = re.rspBody.hsVisitorManageList

          $('#来访登记').modal('show')

          setTimeout(function(){
            $('.fancybox').fancybox()
          })

        }
      })
    },

    get来访登记View: function(id){

      this.view = {
        deviceSn: []
      }

      var data = {
        "reqHead":
        {
          clientType: 1,
          format: "json",
          version: "1.0",
          sign: "UCR1fIQ9lyUCR1fIQ9lyUCR1fIQ9lyUCR1y"
        },
        reqBody: {
          id: id,
          auditStatus: 0,
        }
      }

      $.ajax({
        type: 'POST',
        url: mp_api + 'mp/getHsVisitorManageInfo/interface',
        data: JSON.stringify(data),
        dataType: 'json',
        beforeSend: function(request){
          request.setRequestHeader('Authorization', 'Bearer ' + _this.admin.token )
        },
        success: function(re){

          if(re.rspHead.retCode == '1'){

            try{
              re.rspBody.deviceSn = JSON.parse(re.rspBody.deviceSn)
            }catch(e){
              re.rspBody.deviceSn = []
            }


            _this.view = re.rspBody

            _this.view.buildingId = _this.a.buildingId
            _this.view.floorId = _this.a.floorId
            _this.view.roomId = _this.a.roomId

            $('#来访登记view').modal('show')

            setTimeout(function(){
              _this.get楼层()
              _this.get房间()
              }, 100
            )

            //插件的值
            $('#访问时间').val(_this.view.visitTime)
            $('#离开时间').val(_this.view.leaveTime)

            $('.datepicker').datepicker({
              format: 'yyyy-mm-dd'
            })

          }
          else{
            alert(re.rspBody.retMsg)
          }

        }
      })

    },

    save来访登记View: function(){

      var post = {
        visitorManageId: this.view.id,
        auditStatus: 1,
        sex: this.view.sex,
        deviceSn: JSON.stringify(this.view.deviceSn),
        beVisited: this.view.beVisited,
        tote: this.view.tote,
        visitTime: $('#访问时间').val(),
        leaveTime: $('#离开时间').val(),
        // expireTime: "2020-03-04",
        validCycle: '',//李玉明要求传空值
      }

      if(this.admin.softwareVersion == 60001){
        post.departId = this.view.departId

        var 必选 = {
          departId: '拜访部门',
        }
        for(var i in 必选){
          var v = 必选[i]

          if(post[i] == undefined || post[i] == ''){
            alert('【' + v + '】必选，请录入后再次提交')
            return
          }
        }

      }

      if(this.admin.softwareVersion == 60002){
        post.buildingId = this.view.buildingId
        post.floorId = this.view.floorId
        post.roomId = this.view.roomId
      }

      var 必填 = {
        visitTime: '访问时间',
        leaveTime: '离开时间',
      }
      for(var i in 必填){
        var v = 必填[i]

        if(post[i] == undefined || post[i] == ''){
          alert('【' + v + '】必填，请录入后再次提交')
          return
        }
      }
      if(post.deviceSn == '[]'){
        alert('【通行设备】必选，请选择后再次提交')
        return
      }

      var data = {
        "reqHead":
        {
          clientType: 1,
          format: "json",
          version: "1.0",
          sign: "UCR1fIQ9lyUCR1fIQ9lyUCR1fIQ9lyUCR1y"
        },
        reqBody: post
      }

      $.ajax({
        type: 'POST',
        url: mp_api + 'mp/hsExamine/interface',
        data: JSON.stringify(data),
        dataType: 'json',
        beforeSend: function(request){
          request.setRequestHeader('Authorization', 'Bearer ' + _this.admin.token )
        },
        success: function(re){

          if(re.rspHead.retCode != '1'){
            alert(re.rspHead.retMsg)
          }

          _this.getList()
          _this.get旅客访客(_this.a.roomId)
          _this.get来访登记()
          alert('来访登记成功')
          $('#来访登记view').modal('hide')

        },
      })

    },

    全选: function(变量名, 开关){

      if(开关){

        eval('this.' + 变量名 + '_选中 = this.' + 变量名 + '_全选')

      }else{

        eval('this.' + 变量名 + '_选中 = []')
      }

    },

    批量离店: function(旅客定访客){

      this.msg = '';

      if(旅客定访客 == '旅客'){

        if(this.旅客访客.guestList_选中.length == 0){
          alert('没有选中离店人员')
          return
        }

        this.旅客访客.guestList_菊花 = 1

        for(let i in this.旅客访客.guestList_选中){
          let id = this.旅客访客.guestList_选中[i]
          this.离店(id, 'Guest')
        }

      }

      if(旅客定访客 == '访客'){

        if(this.旅客访客.visitorList_选中.length == 0){
          alert('没有选中离店人员')
          return
        }

        this.旅客访客.visitorList_菊花 = 1


        for(let i in this.旅客访客.visitorList_选中){
          let id = this.旅客访客.visitorList_选中[i]
          this.离店(id, 'Visitor')
        }

      }

      setTimeout(function(){
        _this.旅客访客.guestList_菊花 = 0
        _this.旅客访客.visitorList_菊花 = 0
        alert(_this.msg)
      },1000)

    },

    getView: function(id, 接口地址){

      this.view = {
        deviceSn: []
      }

      if(id == -1){
        this.add_rules()
        $('#view').modal('show')
        return
      }

      var data = {
        "reqHead":
        {
          clientType: 1,
          format: "json",
          version: "1.0",
          sign: "UCR1fIQ9lyUCR1fIQ9lyUCR1fIQ9lyUCR1y"
        },
        reqBody: {
          id: id
        }
      }

      $.ajax({
        type: 'POST',
        url: mp_api + 'mp/getHs' + 接口地址 + 'ManageInfo/interface',
        data: JSON.stringify(data),
        dataType: 'json',
        beforeSend: function(request){
          request.setRequestHeader('Authorization', 'Bearer ' + _this.admin.token )
        },
        success: function(re){

          if(re.rspHead.retCode == '1'){

            try{
              re.rspBody.deviceSn = JSON.parse(re.rspBody.deviceSn)
            }catch(e){
              re.rspBody.deviceSn = []
            }

/*            try{
              re.rspBody.validCycle = JSON.parse(re.rspBody.validCycle)
            }catch(e){
              re.rspBody.validCycle = [{start_time:'00:00',end_time:'23:59'}]
            }*/

            _this.view = re.rspBody

            $('#view').modal('show')
			
      			setTimeout(function(){

      				_this.get楼层()
      				_this.get房间()

              //插件的值
              $('#checkinTime').val(_this.view.checkinTime)
              $('#visitTime').val(_this.view.visitTime)
              $('#leaveTime').val(_this.view.leaveTime)

              $('.datepicker').datepicker({
                format: 'yyyy-mm-dd'
              })

      				}, 100
      			)

          }
          else{
            alert(re.rspBody.retMsg)
          }

        }
      })

    },

    saveView: function(){

      var post = {
        sex: this.view.sex,
        deviceSn: JSON.stringify(this.view.deviceSn),
        buildingId: this.view.buildingId,
        floorId: this.view.floorId,
        roomId: this.view.roomId,
        mobile: this.view.mobile,
        leaveTime: $('#leaveTime').val(),
        // expireTime: "2020-03-04",
        validCycle: '',//李玉明要求传空值
      }

      if(this.view.visitorType == 1){
        post.visitorManageId = this.view.id
        post.auditStatus = this.view.auditStatus
        post.beVisited = this.view.beVisited
        post.tote = this.view.tote
        post.visitTime = $('#visitTime').val()
        var 接口地址 = 'hsExamine'
      }

      if(this.view.visitorType == 3){
        post.id = this.view.id
        post.checkinStatus = this.view.checkinStatus
        post.checkinTime = $('#checkinTime').val()
        var 接口地址 = 'editHsGuestManage'
      }

      var data = {
        "reqHead":
        {
          clientType: 1,
          format: "json",
          version: "1.0",
          sign: "UCR1fIQ9lyUCR1fIQ9lyUCR1fIQ9lyUCR1y"
        },
        reqBody: post
      }

      $.ajax({
        type: 'POST',
        url: mp_api + 'mp/' + 接口地址 + '/interface',
        data: JSON.stringify(data),
        dataType: 'json',
        beforeSend: function(request){
          request.setRequestHeader('Authorization', 'Bearer ' + _this.admin.token )
        },
        success: function(re){

          if(re.rspHead.retCode == '1'){
            _this.getList()
            _this.get旅客访客(_this.旅客访客.roomId)
            $('#view').modal('hide')
          }else{
            alert(re.rspHead.retMsg)
          }

        },
      })

    },

    离店: function(id, 接口地址){

      //拿出来
      var data = {
        "reqHead":
        {
          clientType: 1,
          format: "json",
          version: "1.0",
          sign: "UCR1fIQ9lyUCR1fIQ9lyUCR1fIQ9lyUCR1y"
        },
        reqBody: {
          id: id
        }
      }

      $.ajax({
        type: 'POST',
        url: mp_api + 'mp/getHs' + 接口地址 + 'ManageInfo/interface',
        data: JSON.stringify(data),
        dataType: 'json',
        beforeSend: function(request){
          request.setRequestHeader('Authorization', 'Bearer ' + _this.admin.token )
        },
        success: function(re){

          if(re.rspHead.retCode == '1'){

            //存回去
            var post = re.rspBody

            if(接口地址 == 'Guest'){

              post.checkinStatus = 2

              var 接口地址2 = 'editHsGuestManage'
            }

            if(接口地址 == 'Visitor'){

              var post = {
                visitorManageId: re.rspBody.id,
                auditStatus: 3,
                sex: re.rspBody.sex,
                deviceSn: re.rspBody.deviceSn,
                beVisited: re.rspBody.beVisited,
                mobile: re.rspBody.mobile,
                tote: re.rspBody.tote,
                buildingId: Number(re.rspBody.buildingId),
                floorId: Number(re.rspBody.floorId),
                roomId: Number(re.rspBody.roomId),
                visitTime: re.rspBody.visitTime,
                leaveTime: re.rspBody.leaveTime,
                expireTime: re.rspBody.expireTime,
                validCycle: re.rspBody.validCycle
              }

              var 接口地址2 = 'hsExamine'
            }

            var data = {
              "reqHead":
              {
                clientType: 1,
                format: "json",
                version: "1.0",
                sign: "UCR1fIQ9lyUCR1fIQ9lyUCR1fIQ9lyUCR1y"
              },
              reqBody: post
            }

            $.ajax({
              type: 'POST',
              url: mp_api + 'mp/' + 接口地址2 + '/interface',
              data: JSON.stringify(data),
              dataType: 'json',
              beforeSend: function(request){
                request.setRequestHeader('Authorization', 'Bearer ' + _this.admin.token )
              },
              success: function(re2){

                if(re2.rspHead.retCode == '1'){

                  _this.msg += '【' + re.rspBody.realName + "】已离店\r\n"

                  _this.getList()
                  _this.get旅客访客(_this.旅客访客.roomId)

                }else{

                  _this.msg += '【' + re.rspBody.realName + "】离店失败\r\n"

                  alert(re2.rspHead.signMsg)
                }

              }
            })

          }
          else{
            alert(re.rspBody.retMsg)
          }

        }
      })

    },

    get楼层树: function(){
      var data = {
        "reqHead":
        {
          clientType: 1,
          format: "json",
          version: "1.0",
          sign: "2A71F91102AE746493B3CDF67FCCDCF3"
        },
        "reqBody":{}
      }

      $.ajax({
        type: 'POST',
        url: mp_api + 'mp/getHsFloorTree/interface',
        data: JSON.stringify(data),
        dataType: 'json',
        beforeSend: function(request){
          request.setRequestHeader('Authorization', 'Bearer ' + _this.admin.token )
        },
        success: function(re){
          if(re.rspHead.retCode == '1'){

            _this.楼层树 = re.rspBody.hsBuildingList

      			setTimeout(function(){
      				$(".sideMenu .nLi h3").click(function(){
      					if($(this).parent(".nLi").hasClass("on")){
      					}else{
      						$(this).parents("ul").find(".nLi").removeClass("on")
      						$(this).parent(".nLi").addClass("on")
      					}
      				})
      			}, 100)

          }else{
            alert(re.rspHead.retMsg)
          }
        }
      })
    },

    get组织架构: function(){
      var data = {
        "reqHead":
        {
          clientType: 1,
          format: "json",
          version: "1.0",
          sign: "2A71F91102AE746493B3CDF67FCCDCF3"
        },
        "reqBody":{}
      }

      $.ajax({
        type: 'POST',
        url: mp_api + 'mp/getHsDepartFrame/interface',
        data: JSON.stringify(data),
        dataType: 'json',
        beforeSend: function(request){
          request.setRequestHeader('Authorization', 'Bearer ' + _this.admin.token )
        },
        success: function(re){
          if(re.rspHead.retCode == '1'){
            _this.组织架构 = re.rspBody.hsDepartFrame
          }else{
            alert(re.rspHead.retMsg)
          }
        }
      })
    },

    get通行设备: function(){
      var data = {
        "reqHead":
        {
          clientType: 1,
          format: "json",
          version: "1.0",
          sign: "2A71F91102AE746493B3CDF67FCCDCF3"
        },
        "reqBody":{
          pageSize: 99999
        }
      }

      $.ajax({
        type: 'POST',
        url: mp_api + 'mp/getHsDeviceList/interface',
        data: JSON.stringify(data),
        dataType: 'json',
        beforeSend: function(request){
          request.setRequestHeader('Authorization', 'Bearer ' + _this.admin.token )
        },
        success: function(re){
          if(re.rspHead.retCode == '1'){
            _this.通行设备 = re.rspBody.hsDeviceInfoList
            for(var i in re.rspBody.hsDeviceInfoList){
              var v = re.rspBody.hsDeviceInfoList[i]
              _this.通行设备全选时.push(v.sn)
            }
            _this.通行设备全选时.sort()

          }else{
            alert(re.rspHead.retMsg)
          }
        }
      })
    },

    通行设备排序: function(){

      var tmp = []
      for(var i in this.view.deviceSn){
        tmp.push(this.view.deviceSn[i])
      }
      this.view.deviceSn = tmp.sort()
    },

    通行设备全选: function(how){

      // 先清
      this.view.deviceSn = []

      // 全选
      if(how){

        this.view.deviceSn = this.通行设备全选时

      }

    },

    get楼栋: function(){

      var data = {
        "reqHead":
        {
          clientType: 1,
          format: "json",
          version: "1.0",
          sign: "2A71F91102AE746493B3CDF67FCCDCF3"
        },
        reqBody: {}
      }

      $.ajax({
        type: 'POST',
        url: mp_api + 'mp/getHsBuildingList/interface',
        data: JSON.stringify(data),
        dataType: 'json',
        beforeSend: function(request){
          request.setRequestHeader('Authorization', 'Bearer ' + _this.admin.token )
        },
        success: function(re){

          _this.楼栋 = {}
          for(let i in re.rspBody.hsBuildingInfoList){
            let v = re.rspBody.hsBuildingInfoList[i]
            _this.楼栋[v.id] = v.title
          }
          console.log('楼栋', _this.楼栋)

        }
      })
    },

    get楼层: function(清){

      var data = {
        "reqHead":
        {
          clientType: 1,
          format: "json",
          version: "1.0",
          sign: "2A71F91102AE746493B3CDF67FCCDCF3"
        },
        reqBody: {
          buildingId: this.view.buildingId
        }
      }

      $.ajax({
        type: 'POST',
        url: mp_api + 'mp/getHsFloorListByBuildingId/interface',
        data: JSON.stringify(data),
        dataType: 'json',
        beforeSend: function(request){
          request.setRequestHeader('Authorization', 'Bearer ' + _this.admin.token )
        },
        success: function(re){

          _this.楼层 = {}
          for(let i in re.rspBody.hsFloorInfoList){
            let v = re.rspBody.hsFloorInfoList[i]
            _this.楼层[v.id] = v.title
          }
          console.log('楼层', _this.楼层)
          
          if(清 != undefined){
            _this.view.floorId = ''
            _this.房间 = {}
            _this.view.roomId = ''
          }

        }
      })
    },


    get房间: function(清){

      var data = {
        "reqHead":
        {
          clientType: 1,
          format: "json",
          version: "1.0",
          sign: "2A71F91102AE746493B3CDF67FCCDCF3"
        },
        reqBody: {
      floorId: this.view.floorId
    }
      }

      $.ajax({
        type: 'POST',
        url: mp_api + 'mp/getHsRoomList/interface',
        data: JSON.stringify(data),
        dataType: 'json',
        beforeSend: function(request){
          request.setRequestHeader('Authorization', 'Bearer ' + _this.admin.token )
        },
        success: function(re){

          _this.房间 = {}
          for(let i in re.rspBody.hsRoomInfoList){
            let v = re.rspBody.hsRoomInfoList[i]
            _this.房间[v.id] = v.title
          }
          console.log('房间', _this.房间)

          if(清 != undefined){
            _this.view.roomId = ''
          }

        }
      })
    },

  },
  mounted() {
    _this = this

    // console.log(LS.admin)

    // 登录信息
    if(LS.admin != undefined){
      this.admin = JSON.parse(LS.admin)

      var expire = ((this.admin.expire - new Date().getTime() ) / 1000 / 60).toFixed(0)

      console.log('登录超时剩余', expire)

      //过期
      if(expire < 0){
        //console.log('登录超时跳转')
        this.logout()
      }

    }else{

      //未登录
      if(location.hostname == 'www.zzb110.cn'){
        location.href = '../account/index2.html'
      }
      else if(location.hostname == 'iot.longse.cn'){
        location.href = '../account/index-longse.html'
      }else{
        location.href = '../account/index.html'
      }

      return
    }


    if(this.admin.softwareVersion == 60001){
      var url = '../../db/menu-mp-company.json'
    }
    else if(this.admin.softwareVersion == 60002){
      var url = '../../db/menu-mp-hotel.json'
    }
    else if(this.admin.type == 1 || this.admin.type == 2){
      var url = '../../db/menu-mp-agent.json'
    }else if(this.admin.type == 4){
      var url = '../../db/menu-mp-sale-group.json'
    }else{
      var url = '../../db/menu-mp.json'
    }


    // 侧栏菜单
    $.ajax({
      type: 'GET',
      url: url,
      //url: 'http://192.168.199.196:8692/token/generate',
      dataType: 'json',
      beforeSend: function(request){
        //request.setRequestHeader("token", _this.admin.token)
      },
      success: function(re){

        // $.cookie('token', re.data.token);

        // re.data.info.token = re.data.token
        // LS.admin = JSON.stringify(re.data.info)

        _this.sidemenu = re
/*        console.log(_this.sidemenu)

        if(_this.admin.isPrimaryAccount != 1){
          // console.log('我不是主帐户')

          for(var i in _this.sidemenu){
            var v = _this.sidemenu[i]

            if(v.title == '客服管理'){

              console.log(v)
              delete _this.sidemenu[i]
              break

            }
          }
        }*/

      }
    })


    // 显示主体
    $('#loading').hide()
    $('#app').show()

    // mca
    var tmp = location.pathname.split('/')
    this.mca = {
      m: decodeURI(tmp[1]),
      c: decodeURI(tmp[2]),
      a: decodeURI(tmp[3].split('.html')[0]),
    }

    // console.log(this.mca)

    $('[data-toggle="tooltip"]').tooltip()


    this.getList()

    this.get楼层树()


	  this.get楼栋()

    this.get通行设备()

  }
})
</script>
</body>
</html>